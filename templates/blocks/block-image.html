{%- from "macros/makros.html" import constrain_img -%}
{%- set image = record.attachments.get(this.image) -%}
{%- if image._attachment_type == 'image' -%}
<figure>
  {{ constrain_img(image,
                   w=this.width if this.width > 0 else None,
                   h=this.height if this.height > 0 else None) }}
  <figcaption>{{ this.contents }}</figcaption>
</figure>
{%- endif -%}